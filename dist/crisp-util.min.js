/*! OpenCrisp UtilJS - v0.1.3 - 2015-09-11
* https://github.com/OpenCrisp/Crisp.UtilJS
* Copyright (c) 2015 Fabian Schmid; Licensed MIT */
!function(a){function b(a,b,c){var d=c.args;void 0===d&&(d=c),d=[].concat(d),a.apply(b,d),"function"==typeof c.complete&&c.complete.apply(b,d)}function c(a){var b=e.call(a).replace(f,"$1");return-1!==["global","Null","DOMWindow"].indexOf(b)&&(b="Undefined"),b}function d(a,b){return"field"===b?d(a,"String")||d(a,"Number")||d(a,"Boolean")||d(a,"Date")||d(a,"RegExp"):c(a)===b}var e=Object.prototype.toString,f=/^\[object ([a-z]+)\]$/i;a.Crisp={ns:function(a,b){var c,d=a.split("."),e=this;c=d.length-1;for(var f=0,g=c;g>f;f+=1)e[d[f]]=e[d[f]]||{},e=e[d[f]];if(b){if(!this.isType(e[d[c]],"Undefined"))throw new Error("Can't overwrite '"+a+"' of defined!");e[d[c]]=b}else"undefined"==typeof e[d[c]]&&(e[d[c]]={});return e[d[c]]},utilTick:function(a,c,d,e){return d=d||{},a=a||d.self,e?setTimeout(b,0,c,a,d):b(c,a,d),a},toType:c,isType:d,to:function(){return JSON.stringify(this)},parse:function(){return JSON.parse(this.toString())},type:function(a){return a?d(this,a):c(this)},toMath:function(a){return Math[a].call(Math,this)},math:function(a){return Math[a].call(Math,this)},toJson:function(a){return a?JSON.stringify(this,null,"	"):JSON.stringify(this)},parseJson:function(){return JSON.parse(this.toString())}}}("undefined"!=typeof process&&"undefined"!=typeof process.title&&"undefined"!=typeof global?global:window),function(a){a.ns("util.control.Break",function(){}),a.ns("util.control.End",function(){})}(Crisp),function(a){function b(){for(var c,d=0,e=arguments.length;e>d;d+=1)c=arguments[d],a.isType(c,"Array")?b.apply(this,c):void 0!==c&&this.push(c);return this}function c(a){var b=0,c=this.length,e=a.start?Number(a.start):0,f=void 0===a.limit?c:Number(a.limit);0>=f&&(f=c),0>e&&(e=c+e),e+f>c&&(f-=e+f-c),0>e&&(e=0,f=c);try{for(;f>b;b+=1)a.success.call(a.self,this[b+e],b+e)}catch(g){if(!(g instanceof d))throw g}return this}var d=a.ns("util.control.Break");Object.defineProperty(Array.prototype,"xAdd",{value:b}),Object.defineProperty(Array.prototype,"xEach",{value:function(b){return a.utilTick(this,c,b,b.async)}})}(Crisp),function(a){Number.isInteger=Number.isInteger||function(b){return a.isType(b,"Number")&&isFinite(b)&&Math.floor(b)===b},Object.defineProperty(Number.prototype,"toMath",{value:a.toMath}),Object.defineProperty(Number.prototype,"xMath",{value:a.math})}(Crisp),function(a){function b(a){var b,d=Object.keys(this),e=0,f=d.length,g=a.start?Number(a.start):0,h=void 0===a.limit?f:Number(a.limit);0>=h&&(h=f),0>g&&(g=f+g),g+h>f&&(h-=g+h-f),0>g&&(g=0,h=f);try{for(;h>e;e+=1)b=d[e+g],a.success.call(a.self,this[b],b)}catch(i){if(!(i instanceof c))throw i}return this}var c=a.ns("util.control.Break");Object.defineProperty(Object.prototype,"xEach",{value:function(c){return a.utilTick(this,b,c,c.async)}}),Object.defineProperty(Object.prototype,"xTo",{value:a.to}),Object.defineProperty(Object.prototype,"xType",{value:a.type}),Object.defineProperty(Object.prototype,"toURLParam",{value:function(){var b=[];return this.xEach({success:function(c,d){var e="";e=a.isType(c,"Object")?c.xTo():a.isType(c,"Array")?c.xTo():a.isType(c,"Boolean")?c.xTo():c.toString(),e=d.concat("=",e),b.push(e)}}),b.join("&")}})}(Crisp),function(a){var b=/[.*+?^${}()|[\]\\]/g;RegExp.escape=RegExp.escape||function(a){return a.replace(b,"\\$&")},Object.defineProperty(RegExp.prototype,"xTo",{value:function(){return a.to.call(this.toString())}})}(Crisp),function(a){Object.defineProperty(String.prototype,"toMath",{value:a.toMath}),Object.defineProperty(String.prototype,"xMath",{value:a.math}),Object.defineProperty(String.prototype,"xParse",{value:a.parse})}(Crisp),function(a){function b(a){if(this.prototype[a]&&"toString"!==a)throw new Error("Redefined prototype "+a);if(this.hasOwnProperty(a))throw new Error("Can't overwride prototype."+a+" with property!")}function c(a,c){b.call(this,c),this.prototype[c]=a}function d(a){a.xEach({self:this,success:c})}function e(a){a.xEach({self:this,success:d})}function f(a,b){var c={};void 0!==b.proEnu&&(c.enumerable=b.proEnu),void 0!==b.proCon&&(c.configurable=b.proCon),void 0!==b.proWri&&(c.writable=b.proWri),void 0!==b.proVal?c.value=b.proVal:(void 0!==b.proGet||void 0!==b.proSet)&&(c.get=b.proGet,c.set=b.proSet),Object.defineProperty(this,a,c)}function g(a,b){f.call(this,b,a)}function h(a){a.xEach({self:this,success:g})}function i(a){a.xEach({self:this,success:h})}function j(a,b){f.call(this,m(b),a)}function k(a){a.xEach({self:this,success:j})}function l(a){a.xEach({self:this,success:k})}function m(a){return u.concat(a,u)}function n(a,b){if(!this.hasOwnProperty(a))throw new Error("set Option: Property '"+a+"' not defined!");return this[a]=b,this}function o(a,b){n.call(this,m(b),a)}function p(a){a.xEach({self:this,success:o})}function q(a){return[].xAdd(a).xEach({self:this,success:p}),this}function r(a,b){var c=this[a];return void 0===c&&(c="function"==typeof b.preset?b.preset.call(this):b.preset,b.insert&&n.call(this,a,c)),c}function s(a,b){var c=this.data[b];void 0!==c&&(this.obj[b]=c)}function t(b){var c=a.ns(b);this.op.xAdd(c.options),this.pp.xAdd(c.properties),this.pt.xAdd(c.prototypes)}var u="__",v={};a.utilProperty=f,a.ns("util.create").prototypes={objIni:function(a){var b=this._("create");return l.call(this,b.options),i.call(this,b.properties),q.call(this,a)},_:function(b){var c,d;return a.type.call(b,"String")?this[m(b)]:(d=m(b.name),c=r.call(this,d,b),b.after&&n.call(this,d,c+b.after),b.before&&n.call(this,d,c+=b.before),c)},objSet:function(a,b){return n.call(this,m(a),b)},objData:function(a){return(this.objNs("util.props")?this:a).xEach({self:{obj:this,data:a},success:s}),this},objClone:function(){function a(){}return a.prototype=this,new a},objNs:function(a){return-1!==this._("create").ns.indexOf(a)}},a.utilCreate=function(a){var b,c,d,g;return a=a||{},v[a.once]?v[a.once].objClone():(b=a.base||function(){},c={op:[],pp:[],pt:[]},d=["util.create"].xAdd(a.ns).xEach({self:c,success:t}),e.call(b,c.pt.xAdd(a.prototypes)),g=new b,f.call(g,m("create"),{proVal:{ns:d,options:c.op.xAdd(a.options),properties:c.pp.xAdd(a.properties)}}),a.once?(v[a.once]=g,g.objClone()):g)}}(Crisp),function(a){function b(a){var b;if(void 0!==a)return n.call(a,"RegExp")?a:(b=a.split(" "),b.map(function(a){return m(a)}),new RegExp("(^|\\s)("+b.join("|")+")($|\\s|\\.)"))}function c(a){var b;if(void 0!==a)return n.call(a,"RegExp")?a:(b=a.split(" "),b.map(function(a){return m(a)}),new RegExp("^("+b.join("|")+")$"))}function d(){this._list={}}function e(a,b,c,e,f,g){this.self=a,this.action=c,this.path=f,this.repeat=!0,this.picker=b,this._treat=e,this._empty=g,this._wait=1,this._note=new d}function f(a){this._listen=a.listen,this._self=a.self,this._async=a.async,this._action=b(a.action),this._path=c(a.path),this._noteAction=b(a.noteAction),this._notePath=c(a.notePath),this._noteList=a.noteList||o}function g(){this._listener=[]}function h(a,b){return a.self=a.self||this,b.add(a)}function i(a,b,c){return a=a||{},a.self=a.self||this,b.trigger(a),a.repeat&&c&&n.call(c.eventTrigger,"Function")&&c.eventTrigger(a),this}function j(a){var b,c,d;return c=a.cache.picker=a.cache.picker||{},b=a.action||p,d=b.split(".")[0],c[d]instanceof e?c[d].Wait():(!a.path&&n.call(this.docPath,"Function")&&(a.path=this.docPath()),c[d]=new e(this,c,b,d,a.path,a.empty))}function k(a,b){return b.remove(a),this}var l=a.utilTick,m=RegExp.escape,n=a.type,o="own",p="task";d.prototype={List:function(a){return a=a||o,this._list[a]=this._list[a]||[]},Length:function(a){var b,c=0;if(void 0!==a);else for(b in this._list)c+=this._list[b].length;return c},Empty:function(a){return 0===this.Length(a)},Add:function(a,b){this.List(a.type||b).push(a)}},e.prototype={Wait:function(){return this._wait+=1,this},Talk:function(){return this._wait-=1,this._wait>0||!this._empty&&this._note.Empty()?this:(delete this.picker[this._treat],this.self.eventTrigger(this),this)},Note:function(a,b){return this._note.Add(a,b),this},List:function(a){return this._note.List(a)},Test:function(a){var b=0;return this._note.List(a._noteList).forEach(function(c){var d=0;a._notePath&&!a._notePath.test(c.path)&&(d+=1),a._noteAction&&!a._noteAction.test(c.action)&&(d+=1),0===d&&(b+=1)}),0===b}},f.prototype={talk:function(a){this._self!==a.exporter&&(!this._action||this._action.test(a.action))&&(!this._path||this._path.test(a.path))&&(!this._notePath&&!this._noteAction||a instanceof e&&!a.Test(this))&&l(this._self,this._listen,a,this._async)},is:function(a){var c;return c=this._action&&a.action?this._action.toString()===b(a.action).toString():void 0===this._action||void 0===a.action,this._listen===a.listen&&c}},g.prototype={add:function(a){for(var b,c=this._listener,d=0,e=c.length;e>d;d+=1)if(c[d].is(a))return c[d];return b=new f(a),c.push(b),b},trigger:function(a){for(var b=this._listener,c=0,d=b.length;d>c;c+=1)b[c].talk(a);return this},remove:function(a){for(var b=this._listener,c=0,d=b.length;d>c;c+=1)if(b[c]===a){b.splice(c,1);break}return this}};var q={name:"event",preset:function(){return new g},insert:!0},r={name:"parent",preset:{}},s={proWri:!0};a.ns("util.event").options={event:s},a.ns("util.event").prototypes={eventListener:function(a){return h.call(this,a,this._(q))},eventTrigger:function(a){return i.call(this,a,this._(q),this._(r))},eventPicker:j,eventRemove:function(a){return k.call(this,a,this._(q))}},a.defineEvent=function(a,b){return b=b||{},b.event=b.event||"__event__",b.parent=b.parent||"__parent__",Object.defineProperty(a,b.event,{writabel:!0,value:new g}),Object.defineProperties(a,{eventListener:{value:function(a){return h.call(this,a,this[b.event])}},eventTrigger:{value:function(a){return i.call(this,a,this[b.event],this[b.parent])}},eventPicker:{value:j},eventRemove:{value:function(a){return k.call(this,a,this[b.event])}}}),a}}(Crisp),function(a){function b(a){return A.call(a,"Function")}function c(a,b){for(var c=0;a>c;c+=1)b="false"===b||b===!1?!0:!b;return b}function d(b,c){var d;if(b)return b._reason={},a.defineEvent(b._reason),b._reason.eventListener({limit:1,action:"success",listen:function(a){d=a}}),b.exec(c),d}function e(a){var b,c,d,f,g=new h(this,a);for(f=d=g.add(1),I.lastIndex=this._index;!c&&(b=I.exec(this._path));)this._index=I.lastIndex,J+=1,void 0!==b[1]?(f._operator=b[1],f=f.value=g.add()):void 0!==b[2]?f._reverse=b[2].length:void 0!==b[3]?(d._next=b[3],f=d=g.add(1)):void 0!==b[4]?f.child=e.call(this,f):void 0!==b[5]?c=!0:void 0!==b[6]?f.child=new s(f,Number(b[6])):void 0!==b[7]?f.child=new s(f,"true"===b[7]):void 0!==b[8]?f.child=new s(f,b[8].replace(D,'"')):void 0!==b[9]?f.child=new s(f,b[9].replace(E,"'")):void 0!==b[10]?f.child=new s(f,new RegExp(b[10],b[11])):void 0!==b[12]?f.child=new s(f,this.valueKey(b[12])):(this._index=b.index,f.parse()),I.lastIndex=this._index;return g}function f(a){var b;if(a.next("&")){if(b=d(a,this.node),!b)throw new B}else if(a.next("|")){if(b=d(a,this.node))throw this.reason.eventTrigger({action:"success",args:b}),new B}else a.exec(this.node)}function g(){}function h(a,b){b||(this._reason=a),this._parent=b,this.condition=[]}function i(a){this._parent=a}function j(a){var b;N.lastIndex=this._index;var c=N.exec(this._path);if(c){if(this._index=N.lastIndex,void 0!==c[1])b=new n(a).parse();else if(void 0!==c[2])b=new m(a,c[2]).parse();else if(void 0!==c[3])b=new o(a,c[3]).parse();else if(void 0!==c[4])b=new p(a,c[4]).parse();else if(void 0!==c[5])b=new o(a,this.valueKey(c[5])).parse();else if(void 0!==c[6])b=q.call(this,a);else{if(void 0===c[7])return void(this._index=c.index);b=new k(a).parse()}return b}}function k(a){this._parent=a}function l(a,b,c){try{return this._("config")[a](b)}catch(d){return b||c}}function m(a,b){this._parent=a,P.test(b)?(b=P.exec(b),this._start=b[1],this._limit=b[2]):this._start=b}function n(a){this._parent=a}function o(a,b){Object.defineProperty(this,"_parent",{value:a}),this._attr=b}function p(a,b){this._parent=a,this._type=b}function q(a){var b,c;if(a instanceof r||(c=new r(a)),W.lastIndex=this._index,b=W.exec(this._path),!b)return c;if(this._index=W.lastIndex,void 0!==b[1])c=new r(a);else{if(void 0===b[2])return this._index=b.index,c;c=new r(a,b[2]),b[3]&&b[3].length>0&&(c._args=JSON.parse("["+b[3]+"]"))}return c.parse()}function r(a,b){this._parent=a,this._name=b}function s(a,b){this._parent=a,this._value=b}function t(a){if(this.child)return this.child.exec(a);var b=this.reason();if(!((b._count+=1)<=b._start)){var c=b.eventPicker({cache:b,action:"complete",empty:!0});if(b.eventTrigger({action:"success",args:a}),c.Note({data:a}),c.Talk(),-1!==b._limit&&c._note.Length()>=b._limit)throw c.Talk(),new C}}function u(a){var b=e.call(a);try{b.exec(this)}catch(c){if(c instanceof C)return;if(void 0!==a._preset)return void a.eventTrigger({action:"success",args:a._preset});if(c instanceof B)return;throw new Error(c)}}function v(a){this._path=a.path,this._values=a.values,this._preset=a.preset,this._limit=a.limit,this._start=a.start,this._async=a.async,this._count=0,this._index=0}function w(a){var b;return a=a||"",a.xType("String")&&(a={path:a}),a.limit=1,a.async=!1,a.success=function(a){b=a},this.pathFind(a),A.call(b,"Undefined")&&(b=A.call(a.preset,"Function")?a.preset.call(this):a.preset),b}function x(c){var d;c=c||{},d=c.self||this,c.limit=c.limit||-1,c.start=c.start||0;var e=new v(c);return a.defineEvent(e),b(c.success)&&e.eventListener({action:"success",self:d,listen:c.success}),b(c.complete)&&e.eventListener({action:"complete",self:d,listen:c.complete}),z(this,u,e,c.async),this}function y(a){return void 0!==this.pathNode({path:a})}var z=a.utilTick,A=a.type,B=a.ns("util.control.Break"),C=a.ns("util.control.End"),D=/\\"/g,E=/\\'/g,F={">":function(a,b){return a>b},"<":function(a,b){return b>a},">=":function(a,b){return a>=b},"<=":function(a,b){return b>=a},"==":function(a,b){return a===b},"!=":function(a,b){return a!==b}},G={"*":function(a){a.xEach({self:this,success:function(a){t.call(this,a)}})},"+":function(a){this.child&&(this._specific=this.child.filter),d(this.specific(),a)&&this.child.exec(a)},"#":function(a){var b=this.specific(),c=b?d(b,a):!0;c&&(this.child.exec(a),(A.call(a,"Array")||A.call(a,"Object"))&&a.xEach({self:this,success:function(a){G["#"].call(this,a)}}))}},H='\\s*(?:(\\!=|[<>=]{1,2})|(\\!+)|(&|\\|)|(\\[|\\()|(\\]|\\))\\.?|(\\d+(?:\\.\\d+)?)(?!\\.|:)|(true|false)|"((?:[^"\\\\]*|\\\\"|\\\\)*)"|'+"'((?:[^'\\\\]*|\\\\'|\\\\)*)'|\\/((?:[^\\/\\\\]*|\\\\\\/|\\\\)+)\\/([igm]{1,3})?|\\$([\\w]+)|.+)\\s*",I=new RegExp(H,"g"),J=0;g.prototype={parent:function(a){return a?this._parent&&b(this._parent[a])&&this._parent[a]():this._parent},reason:function(){return this._reason||this.parent("reason")},specific:function(){return this._specific||this.parent("specific")}};var K=h.prototype=new g;K.add=function(a){var b=new i(this);return a&&this.condition.push(b),b},K.exec=function(a){var b=this.reason(),c=b.eventPicker({cache:b,action:"complete",empty:!0});this.condition.xEach({self:{node:a,reason:b},success:f}),c.Talk()};var L=i.prototype=new g;L.parse=function(){return this.child=j.call(this.reason(),this),this},L.exec=function(a){var b,e;return this.reverse()||this.operator()?(b=d(this.child,a),b=c(this.reverse(),b),this.operator()&&(e=d(this.value,a),e instanceof RegExp&&(b=e.test(b),e=!0),b=F[this.operator()](b,e)),void this.reason().eventTrigger({action:"success",args:b})):t.call(this,a)},L.reverse=function(){return this._reverse||0},L.operator=function(){return this._operator||0},L.next=function(a){return a?this._next===a:this._next};var M="\\s*(?:(\\.)|(-?\\d*~\\d*|-\\d+)\\.?|(\\d+|[a-z][a-z\\d\\-]*)\\.?|([*#+])\\.?|\\$([a-z\\d_]+)\\.?|(:)|(\\[|\\()|.+)\\s*",N=new RegExp(M,"g"),O=k.prototype=new g;O.parse=function(){return this.filter=e.call(this.reason(),this),this.child=j.call(this.reason(),this),this},O.exec=function(a){return d(this.filter,a)?(t.call(this,a),!0):void 0};var P=/^(-?\d+)?~(\d+)?$/,Q=m.prototype=new g;Q.parse=function(){return this.child=j.call(this.reason(),this),this},Q.exec=function(a){a.xEach({self:this,start:l.call(a,"optStart",this._start,0),limit:l.call(a,"optLimit",this._limit,10),success:function(a){t.call(this,a)}})};var R=n.prototype=new g;R.parse=function(){return this.child=j.call(this.reason(),this),this},R.exec=function(a){t.call(this,a.__parent__)};var S=o.prototype=new g;S.parse=function(){return this.child=j.call(this.reason(),this),this},S.exec=function(a){a[this.attr()]&&(a=a[this.attr()],t.call(this,a))},S.attr=function(){return this._attr};var T=p.prototype=new g;T.parse=function(){return this.child=j.call(this.reason(),this),this},T.exec=function(a){G[this.type()].call(this,a)},T.type=function(){return this._type};var U="(?:[^)\\\\]*|\\\\\\)|\\\\)+",V="(?:(\\.)|(\\w+)(?:\\(("+U+")\\))?\\.?)\\s*|.+",W=new RegExp(V,"g"),X=r.prototype=new g;X.parse=function(){return this.child=q.call(this.reason(),this),this},X.exec=function(a){if(!b(a[this.name()]))throw new Error("PathFunction "+this.name()+" is not defined!");a=a[this.name()].apply(a,this.args()),t.call(this,a)},X.name=function(){return this._name||"toString"},X.args=function(){return this._args};var Y=s.prototype=new g;Y.exec=function(){t.call(this,this._value)},v.prototype={valueKey:function(a){return this._values[a]}},a.ns("util.path").prototypes={pathNode:w,pathFind:x,pathExists:y},a.definePath=function(a){Object.defineProperties(a,{pathNode:{value:w},pathFind:{value:x},pathExists:{value:y}})}}(Crisp);