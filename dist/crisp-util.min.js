/*! OpenCrisp UtilJS - v0.1.0 - 2015-08-04
* http://opencrisp.wca.at
* Copyright (c) 2015 Fabian Schmid; Licensed MIT */
!function(a){function b(a,b,c){var d=c.args||c;d=[].concat(d),a.apply(b,d),"function"==typeof c.complete&&c.complete.apply(b,d)}var c=Object.prototype.toString;a.Crisp={ns:function(a,b){var c,d=a.split("."),e=this;c=d.length-1;for(var f=0,g=c;g>f;f+=1)e[d[f]]=e[d[f]]||{},e=e[d[f]];if(b){if(!this.isType(e[d[c]],"Undefined"))throw new Error("Can't overwrite '"+a+"' of defined!");e[d[c]]=b}else"undefined"==typeof e[d[c]]&&(e[d[c]]={});return e[d[c]]},utilTick:function(a,c,d,e){return d=d||{},a=a||d.self,e?setTimeout(b,0,c,a,d):b(c,a,d),a},toType:function(a){return c.call(a)},isType:function(a,b){return"Undefined"===b?-1!==["[object Undefined]","[object DOMWindow]"].indexOf(c.call(a)):c.call(a)==="[object ".concat(b,"]")},toMath:function(a){return Math[a].call(Math,this)},to:function(){return JSON.stringify(this)},parse:function(){return JSON.parse(this.toString())},toJson:function(a){return a?JSON.stringify(this,null,"	"):JSON.stringify(this)},parseJson:function(){return JSON.parse(this.toString())}}}("undefined"!=typeof process&&"undefined"!=typeof process.title&&"undefined"!=typeof global?global:window),function(a){a.ns("util.control.Break",function(){}),a.ns("util.control.End",function(){})}(Crisp),function(a){function b(){for(var c,d=0,e=arguments.length;e>d;d+=1)c=arguments[d],a.isType(c,"Array")?b.apply(this,c):void 0!==c&&this.push(c);return this}function c(a){var b=0,c=this.length,e=a.start?Number(a.start):0,f=void 0===a.limit?c:Number(a.limit);0>=f&&(f=c),0>e&&(e=c+e),e+f>c&&(f-=e+f-c),0>e&&(e=0,f=c);try{for(;f>b;b+=1)a.success.call(a.self,this[b+e],b+e)}catch(g){if(!(g instanceof d))throw g}return this}var d=a.ns("util.control.Break");Object.defineProperty(Array.prototype,"xAdd",{value:b}),Object.defineProperty(Array.prototype,"xEach",{value:function(b){return a.utilTick(this,c,b,b.async)}}),Object.defineProperty(Array.prototype,"xTo",{value:a.to})}(Crisp),function(a){Object.defineProperty(Boolean.prototype,"xTo",{value:a.to})}(Crisp),function(a){Object.defineProperty(Date.prototype,"xTo",{value:a.to})}(Crisp),function(a){Number.isInteger=Number.isInteger||function(b){return a.isType(b,"Number")&&isFinite(b)&&Math.floor(b)===b},Object.defineProperty(Number.prototype,"toMath",{value:a.toMath}),Object.defineProperty(Number.prototype,"xTo",{value:a.to})}(Crisp),function(a){function b(a){var b,d=Object.keys(this),e=0,f=d.length,g=a.start?Number(a.start):0,h=void 0===a.limit?f:Number(a.limit);0>=h&&(h=f),0>g&&(g=f+g),g+h>f&&(h-=g+h-f),0>g&&(g=0,h=f);try{for(;h>e;e+=1)b=d[e+g],a.success.call(a.self,this[b],b)}catch(i){if(!(i instanceof c))throw i}return this}var c=a.ns("util.control.Break");Object.defineProperty(Object.prototype,"xEach",{value:function(c){return a.utilTick(this,b,c,c.async)}}),Object.defineProperty(Object.prototype,"xTo",{value:a.to}),Object.defineProperty(Object.prototype,"toURLParam",{value:function(){var b=[];return this.xEach({success:function(c,d){var e="";e=a.isType(c,"Object")?c.xTo():a.isType(c,"Array")?c.xTo():a.isType(c,"Boolean")?c.xTo():c.toString(),e=d.concat("=",e),b.push(e)}}),b.join("&")}})}(Crisp),function(){var a=/[.*+?^${}()|[\]\\]/g;RegExp.escape=RegExp.escape||function(b){return b.replace(a,"\\$&")}}(Crisp),function(a){Object.defineProperty(String.prototype,"toMath",{value:a.toMath}),Object.defineProperty(String.prototype,"xTo",{value:a.to}),Object.defineProperty(String.prototype,"xParse",{value:a.parse})}(Crisp),function(a){function b(a){if(this.prototype[a]&&"toString"!==a)throw new Error("Redefined prototype "+a);if(this.hasOwnProperty(a))throw new Error("Can't overwride prototype."+a+" with property!")}function c(a,c){b.call(this,c),this.prototype[c]=a}function d(a){a.xEach({self:this,success:c})}function e(a){a.xEach({self:this,success:d})}function f(a,b){var c={};void 0!==b.proEnu&&(c.enumerable=b.proEnu),void 0!==b.proCon&&(c.configurable=b.proCon),void 0!==b.proWri&&(c.writable=b.proWri),void 0!==b.proVal?c.value=b.proVal:(void 0!==b.proGet||void 0!==b.proSet)&&(c.get=b.proGet,c.set=b.proSet),Object.defineProperty(this,a,c)}function g(a,b){f.call(this,b,a)}function h(a){a.xEach({self:this,success:g})}function i(a){a.xEach({self:this,success:h})}function j(a,b){f.call(this,m(b),a)}function k(a){a.xEach({self:this,success:j})}function l(a){a.xEach({self:this,success:k})}function m(a){return u.concat(a,u)}function n(a,b){if(!this.hasOwnProperty(a))throw new Error("set Option: Property '"+a+"' not defined!");return this[a]=b,this}function o(a,b){n.call(this,m(b),a)}function p(a){a.xEach({self:this,success:o})}function q(a){return[].xAdd(a).xEach({self:this,success:p}),this}function r(a,b){var c=this[a];return void 0===c&&(c="function"==typeof b.preset?b.preset.call(this):b.preset,b.insert&&n.call(this,a,c)),c}function s(a,b){var c=this.data[b];void 0!==c&&(this.obj[b]=c)}function t(b){var c=a.ns(b);this.op.xAdd(c.options),this.pp.xAdd(c.properties),this.pt.xAdd(c.prototypes)}var u="__",v={};a.utilProperty=f,a.ns("util.create").prototypes={objIni:function(a){var b=this._("create");return l.call(this,b.options),i.call(this,b.properties),q.call(this,a)},_:function(b){var c,d;return a.isType(b,"String")?this[m(b)]:(d=m(b.name),c=r.call(this,d,b),b.after&&n.call(this,d,c+b.after),b.before&&n.call(this,d,c+=b.before),c)},objSet:function(a,b){return n.call(this,m(a),b)},objData:function(a){return this.xEach({self:{obj:this,data:a},success:s})},objClone:function(){function a(){}return a.prototype=this,new a}},a.utilCreate=function(a){var b,c,d;return a=a||{},v[a.once]?v[a.once].objClone():(b=a.base||function(){},c={op:[],pp:[],pt:[]},["util.create"].xAdd(a.ns).xEach({self:c,success:t}),e.call(b,c.pt.xAdd(a.prototypes)),d=new b,f.call(d,m("create"),{proVal:{options:c.op.xAdd(a.options),properties:c.pp.xAdd(a.properties)}}),a.once?(v[a.once]=d,d.objClone()):d)}}(Crisp),function(a){function b(a){var b;if(void 0!==a)return n(a,"RegExp")?a:(b=a.split(" "),b.map(function(a){return m(a)}),new RegExp("^("+b.join("|")+")\\.?"))}function c(a){var b;if(void 0!==a)return n(a,"RegExp")?a:(b=a.split(" "),b.map(function(a){return m(a)}),new RegExp("^("+b.join("|")+")$"))}function d(){this._list={}}function e(a,b,c,e,f,g){this.self=a,this.picker=b,this.action=c,this.treat=e,this.path=f,this._empty=g,this.wait=1,this.repeat=!0,this.note=new d}function f(a){this._listen=a.listen,this._self=a.self,this._async=a.async,this._action=b(a.action),this._path=c(a.path),this._noteAction=b(a.noteAction),this._notePath=c(a.notePath),this._noteList=a.noteList||o}function g(){this._listener=[]}function h(a,b){return a.self=a.self||this,b.add(a)}function i(b,c,d){return b=b||{},b.self=b.self||this,c.trigger(b),b.repeat&&d&&a.isType(d.eventTrigger,"Function")&&d.eventTrigger(b),this}function j(b){var c,d,f;return d=b.cache.picker=b.cache.picker||{},c=b.action||p,f=c.split(".")[0],d[f]instanceof e?d[f].Wait():(!b.path&&a.isType(this.docPath,"Function")&&(b.path=this.docPath()),d[f]=new e(this,d,c,f,b.path,b.empty))}function k(a,b){return b.remove(a),this}var l=a.utilTick,m=RegExp.escape,n=a.isType,o="own",p="task";d.prototype={List:function(a){return a=a||o,this._list[a]=this._list[a]||[]},Length:function(a){var b,c=0;if(void 0!==a);else for(b in this._list)c+=this._list[b].length;return c},Empty:function(a){return 0===this.Length(a)},Add:function(a,b){this.List(a.type||b).push(a)}},e.prototype={Wait:function(){return this.wait+=1,this},Talk:function(){return this.wait-=1,this.wait>0||!this._empty&&this.note.Empty()?this:(delete this.picker[this.treat],this.self.eventTrigger(this),this)},Note:function(a,b){return this.note.Add(a,b),this},Test:function(a){var b=0;return this.note.List(a._noteList).forEach(function(c){var d=0;a._notePath&&!a._notePath.test(c.path)&&(d+=1),a._noteAction&&!a._noteAction.test(c.action)&&(d+=1),0===d&&(b+=1)}),0===b}},f.prototype={talk:function(a){this._self!==a.exporter&&(!this._action||this._action.test(a.action))&&(!this._path||this._path.test(a.path))&&(!this._notePath&&!this._noteAction||a instanceof e&&!a.Test(this))&&l(this._self,this._listen,a,this._async)},is:function(a){var c;return c=this._action&&a.action?this._action.toString()===b(a.action).toString():void 0===this._action||void 0===a.action,this._listen===a.listen&&c}},g.prototype={add:function(a){for(var b,c=this._listener,d=0,e=c.length;e>d;d+=1)if(c[d].is(a))return c[d];return b=new f(a),c.push(b),b},trigger:function(a){for(var b=this._listener,c=0,d=b.length;d>c;c+=1)b[c].talk(a);return this},remove:function(a){for(var b=this._listener,c=0,d=b.length;d>c;c+=1)if(b[c]===a){b.splice(c,1);break}return this}};var q={name:"event",preset:function(){return new g},insert:!0},r={name:"parent",preset:{}},s={proWri:!0};a.ns("util.event").options={event:s},a.ns("util.event").prototypes={eventListener:function(a){return h.call(this,a,this._(q))},eventTrigger:function(a){return i.call(this,a,this._(q),this._(r))},eventPicker:j,eventRemove:function(a){return k.call(this,a,this._(q))}},a.defineEvent=function(a,b){return b=b||{},b.event=b.event||"__event__",b.parent=b.parent||"__parent__",Object.defineProperty(a,b.event,{writabel:!0,value:new g}),Object.defineProperties(a,{eventListener:{value:function(a){return h.call(this,a,this[b.event])}},eventTrigger:{value:function(a){return i.call(this,a,this[b.event],this[b.parent])}},eventPicker:{value:j},eventRemove:{value:function(a){return k.call(this,a,this[b.event])}}}),a}}(Crisp),function(a){function b(a){return v(a,"Function")}function c(a,b){for(var c=0;a>c;c+=1)b="false"===b||b===!1?!0:!b;return b}function d(b,c){var d;if(b)return b._reason={},a.defineEvent(b._reason),b._reason.eventListener({limit:1,action:"success",listen:function(a){d=a}}),b.exec(c),d}function e(a){var b,c,d,f,h=new g(this,a);for(f=d=h.add(1),this.level+=1,D.lastIndex=this.index;!c&&(b=D.exec(this.path));)this.index=D.lastIndex,E+=1,void 0!==b[1]?(f._operator=b[1],f=f.value=h.add()):void 0!==b[2]?f._reverse=b[2].length:void 0!==b[3]?(d._next=b[3],f=d=h.add(1)):void 0!==b[4]?f.child=e.call(this,f):void 0!==b[5]?c=!0:void 0!==b[6]?f.child=new q(f,Number(b[6])):void 0!==b[7]?f.child=new q(f,"true"===b[7]):void 0!==b[8]?f.child=new q(f,b[8].replace(y,'"')):void 0!==b[9]?f.child=new q(f,b[9].replace(z,"'")):void 0!==b[10]?f.child=new q(f,new RegExp(b[10],b[11])):void 0!==b[12]?f.child=new q(f,this.valueKey(b[12])):(this.index=b.index,f.parse()),D.lastIndex=this.index;return this.level-=1,h}function f(a){var b;if(a.next("&")){if(b=d(a,this.node),!b)throw new w}else if(a.next("|")){if(b=d(a,this.node))throw this.reason.eventTrigger({action:"success",args:b}),new w}else a.exec(this.node)}function g(a,b){b||(this._reason=a),Object.defineProperty(this,"_parent",{value:b}),this.condition=[]}function h(a){Object.defineProperty(this,"_parent",{value:a})}function i(a){var b;G.lastIndex=this.index;var c=G.exec(this.path);if(c){if(this.index=G.lastIndex,void 0!==c[1])b=new l(a).parse();else if(void 0!==c[2]||void 0!==c[4])b=new k(a,c[2]||c[4],c[3]).parse();else if(void 0!==c[5])b=new m(a,c[5]).parse();else if(void 0!==c[6])b=new n(a,c[6]).parse();else if(void 0!==c[7])b=new m(a,this.valueKey(c[7])).parse();else if(void 0!==c[8])b=o.call(this,a);else{if(void 0===c[9])return void(this.index=c.index);b=new j(a).parse()}return b}}function j(a){Object.defineProperty(this,"_parent",{value:a})}function k(a,b,c){Object.defineProperty(this,"_parent",{value:a}),this._start=Number(b),this._limit=c&&Math.abs(c)}function l(a){Object.defineProperty(this,"_parent",{value:a})}function m(a,b){Object.defineProperty(this,"_parent",{value:a}),this._attr=b}function n(a,b){Object.defineProperty(this,"_parent",{value:a}),this._type=b}function o(a){var b,c;if(a instanceof p||(c=new p(a)),J.lastIndex=this.index,b=J.exec(this.path),!b)return c;if(this.index=J.lastIndex,void 0!==b[1])c=new p(a);else{if(void 0===b[2])return this.index=b.index,c;c=new p(a,b[2]),b[3]&&b[3].length>0&&(c._args=JSON.parse("["+b[3]+"]"))}return c.parse()}function p(a,b){Object.defineProperty(this,"_parent",{value:a}),this._name=b}function q(a,b){Object.defineProperty(this,"_parent",{value:a}),this._value=b}function r(a){if(this.child)return this.child.exec(a);var b=this.reason(),c=b.eventPicker({cache:b,action:"complete",empty:!0});if(b.eventTrigger({action:"success",args:a}),c.Note({data:a}),c.Talk(),-1!==b.limit&&c.note.Length()>=b.limit)throw c.Talk(),new x}function s(a){var b=e.call(a);try{b.exec(this)}catch(c){if(c instanceof x)return;if(void 0!==a.preset)return void a.eventTrigger({action:"success",args:a.preset});if(c instanceof w)return;throw new Error(c)}}function t(a){this.index=a.index,this.path=a.path,this.values=a.values,this.preset=a.preset,this.limit=a.limit,this.async=a.async,this.level=a.level,this.filter=a.filter}var u=a.utilTick,v=a.isType,w=a.ns("util.control.Break"),x=a.ns("util.control.End"),y=/\\"/g,z=/\\'/g,A={">":function(a,b){return a>b},"<":function(a,b){return b>a},">=":function(a,b){return a>=b},"<=":function(a,b){return b>=a},"==":function(a,b){return a===b},"!=":function(a,b){return a!==b}},B={"*":function(a){a.xEach({self:this,success:function(a){r.call(this,a)}})},"+":function(a){this.child&&(this._specific=this.child.filter),d(this.specific(),a)&&this.child.exec(a)},"#":function(a){var b=this.specific(),c=b?d(b,a):!0;c&&(this.child.exec(a),(v(a,"Array")||v(a,"Object"))&&a.xEach({self:this,success:function(a){B["#"].call(this,a)}}))}},C='\\s*(?:(\\!=|[<>=]{1,2})|(\\!+)|(&|\\|)|(\\[|\\()|(\\]|\\))\\.?|([0-9]+(?:\\.[0-9]+)?)(?!\\.|:)|(true|false)|"((?:[^"\\\\]*|\\\\"|\\\\)*)"|'+"'((?:[^'\\\\]*|\\\\'|\\\\)*)'|\\/((?:[^\\/\\\\]*|\\\\\\/|\\\\)+)\\/([igm]{1,3})?|\\$([\\w]+)|.+)\\s*",D=new RegExp(C,"g"),E=0;g.prototype={parent:function(a){return a?this._parent&&b(this._parent[a])&&this._parent[a]():this._parent},reason:function(){return this._reason||this.parent("reason")},specific:function(){return this._specific||this.parent("specific")},add:function(a){var b=new h(this);return a&&this.condition.push(b),b},exec:function(a){var b=this.reason(),c=b.eventPicker({cache:b,action:"complete",empty:!0});this.condition.xEach({self:{node:a,reason:b},success:f}),c.Talk()}},h.prototype={parent:function(a){return a?this._parent&&b(this._parent[a])&&this._parent[a]():this._parent},reason:function(){return this._reason||this.parent("reason")},specific:function(){return this._specific||this.parent("specific")},parse:function(){return this.child=i.call(this.reason(),this),this},exec:function(a){var b,e;return this.reverse()||this.operator()?(b=d(this.child,a),b=c(this.reverse(),b),this.operator()&&(e=d(this.value,a),e instanceof RegExp&&(b=e.test(b),e=!0),b=A[this.operator()](b,e)),void this.reason().eventTrigger({action:"success",args:b})):r.call(this,a)},reverse:function(){return this._reverse||0},operator:function(){return this._operator||0},next:function(a){return a?this._next===a:this._next}};var F="\\s*(?:(\\.)|(?:(-?[0-9]+)~([0-9]+)|(-[0-9]+))\\.?|([0-9]+|[a-z][a-z0-9\\-]*)\\.?|([*#+])\\.?|\\$([a-z0-9_]+)\\.?|(:)|(\\[|\\()|.+)\\s*",G=new RegExp(F,"g");j.prototype={parent:function(a){return a?this._parent&&b(this._parent[a])&&this._parent[a]():this._parent},reason:function(){return this._reason||this.parent("reason")},specific:function(){return this._specific||this.parent("specific")},parse:function(){return this.filter=e.call(this.reason(),this),this.child=i.call(this.reason(),this),this},exec:function(a){return d(this.filter,a)?(r.call(this,a),!0):void 0}},k.prototype={parent:function(a){return a?this._parent&&b(this._parent[a])&&this._parent[a]():this._parent},reason:function(){return this._reason||this.parent("reason")},specific:function(){return this._specific||this.parent("specific")},parse:function(){return this.child=i.call(this.reason(),this),this},exec:function(a){a.xEach({self:this,start:this._start,limit:this._limit,success:function(a){r.call(this,a)}})}},l.prototype={parent:function(a){return a?this._parent&&b(this._parent[a])&&this._parent[a]():this._parent},reason:function(){return this._reason||this.parent("reason")},specific:function(){return this._specific||this.parent("specific")},parse:function(){return this.child=i.call(this.reason(),this),this},exec:function(a){r.call(this,a.__parent__)}},m.prototype={parent:function(a){return a?this._parent&&b(this._parent[a])&&this._parent[a]():this._parent},reason:function(){return this._reason||this.parent("reason")},specific:function(){return this._specific||this.parent("specific")},parse:function(){return this.child=i.call(this.reason(),this),this},exec:function(a){a[this.attr()]&&(a=a[this.attr()],r.call(this,a))},attr:function(){return this._attr}},n.prototype={parent:function(a){return a?this._parent&&b(this._parent[a])&&this._parent[a]():this._parent},reason:function(){return this._reason||this.parent("reason")},specific:function(){return this._specific||this.parent("specific")},parse:function(){return this.child=i.call(this.reason(),this),this},exec:function(a){B[this.type()].call(this,a)},type:function(){return this._type}};var H="(?:[^)\\\\]*|\\\\\\)|\\\\)+",I="(?:(\\.)|(\\w+)(?:\\(("+H+")\\))?\\.?)\\s*|.+",J=new RegExp(I,"g");p.prototype={parent:function(a){return a?this._parent&&b(this._parent[a])&&this._parent[a]():this._parent},reason:function(){return this._reason||this.parent("reason")},specific:function(){return this._specific||this.parent("specific")},parse:function(){return this.child=o.call(this.reason(),this),this},exec:function(a){if(!b(a[this.name()]))throw new Error("PathFunction "+this.name()+" is not defined!");a=a[this.name()].apply(a,this.args()),r.call(this,a)},name:function(){return this._name||"toString"},args:function(){return this._args}},q.prototype={parent:function(a){return a?this._parent&&b(this._parent[a])&&this._parent[a]():this._parent},reason:function(){return this._reason||this.parent("reason")},specific:function(){return this._specific||this.parent("specific")},exec:function(){r.call(this,this._value)}},t.prototype={valueKey:function(a){return this.values[a]}},a.definePath=function(c){Object.defineProperties(c,{pathNode:{value:function(a){var b,c=this;return a=a||"","[object String]"==={}.toString.call(a)&&(a={path:a}),a.limit=1,a.async=!1,a.success=function(a){b=a},c.pathFind(a),void 0===b&&(b=a.preset),b}},pathFind:{value:function(c){var d=this;c=c||{},c.limit=c.limit||-1,c.index=c.index||0,c.level=0;var e=new t(c);return a.defineEvent(e),b(c.success)&&e.eventListener({action:"success",self:d,listen:c.success}),b(c.complete)&&e.eventListener({action:"complete",self:d,listen:c.complete}),u(d,s,e,c.async),d}},pathExists:{value:function(a){return void 0!==this.pathNode({path:a})}}})}}(Crisp);