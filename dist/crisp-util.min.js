/*! OpenCrisp UtilJS - v0.3.1 - 2017-07-02
* https://github.com/OpenCrisp/Crisp.UtilJS
* Copyright (c) 2017 Fabian Schmid; Licensed [object Object] */

!function(t){function e(t){var e=r.call(t).replace(o,"$1");return-1!==s.indexOf(e)&&(e=p),e}function n(t,i){return"field"===i?n(t,f)||n(t,h)||n(t,c)||n(t,a)||n(t,u):e(t)===i}function i(t,e,i){var r=i.args;void 0===r&&(r=i),r=[].concat(r),t.apply(e,r),n(i.complete,l)&&i.complete.apply(e,r)}var r=Object.prototype.toString,o=/^\[object ([a-z]+)\]$/i,s=["global","Null","DOMWindow","Window"],c="Boolean",a="Date",l="Function",h="Number",u="RegExp",f="String",p="Undefined";t.Crisp={ns:function(t,e){for(var i,r=t.split("."),o=this,s=0,c=i=r.length-1;s<c;s+=1)o[r[s]]=o[r[s]]||{},o=o[r[s]];if(e){if(!n(o[r[i]],p))throw new Error("Can't overwrite '"+t+"' of defined!");o[r[i]]=e}else n(o[r[i]],p)&&(o[r[i]]={});return o[r[i]]},utilTick:function(e,n,r,o){return r=r||{},e=e||r.self,r.async&&(o=!0,delete r.async),o?(t.Crisp.nextTick(i,n,e,r),e):(i(n,e,r),e)},to:function(){return JSON.stringify(this)},parse:function(){return JSON.parse(this.toString())},type:function(t){return t?n(this,t):e(this)},math:function(t){var e=[this];return arguments.xEach({start:1},function(t){e.push(t)}),Math[t].apply(Math,e)}}}("undefined"!=typeof process&&void 0!==process.title&&"undefined"!=typeof global?global:window),function(t){t.ns("util.control.Break",function(){}),t.ns("util.control.End",function(){}),t.ns("util.control.Noop",function(){})}(Crisp),function(t){function e(t,e,n,i,r){t.call(e,n,i),r.call(e,n)}var n=t.ns("util.control.Break"),i="object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:"function"==typeof setImmediate?setImmediate:function(t){return setTimeout.apply(null,[t,0].concat(Array.prototype.slice.call(arguments).slice(1)))};t.nextTick=i,t.utilTack=function(t,r){function o(r,o,s){var c;return r.async&&(c=r.async,delete r.async),o=o||r.success||n,s=s||r.complete||n,c?i(e,t,this,r,o,s):(t.call(this,r,o),s.call(this,r)),this}return Object.defineProperty(o,"tick",{value:r||!0}),Object.defineProperty(o,"callback",{value:t}),o},t.callSchema=function(t,e){var n={};if(Crisp.type.call(e[0],"Object"))return e[0];t=t||[];for(var i=0,r=e.length;i<r;i+=1)n[t[i]||i]=e[i];return n}}(Crisp),function(t){function e(){for(var n,i=0,r=arguments.length;i<r;i+=1)n=arguments[i],t.type.call(n,"Array")?e.apply(this,n):void 0!==n&&this.push(n);return this}function n(t,e,n){var o,s=0,c=1,a=this.length,l=t.start?Number(t.start):0,h=void 0===t.limit?a:Number(t.limit);for(h<=0&&(h=a),l<0&&(l=a+l),l+h>a&&(h-=l+h-a),l<0&&(l=0,h=a),t.reverse&&(l-=a+(c=-1));s<h;s+=1)try{o=(s+l)*c,e.call(t.self,this[o],o,n)}catch(e){if(!(e instanceof i)){if(e instanceof r||o<0)return this;throw e}t.limit&&(t.reverse||o<a&&h<a)&&(h+=1)}return this}var i=t.ns("util.control.Break"),r=t.ns("util.control.End");Object.defineProperty(Array.prototype,"xAdd",{value:e}),t.xEachArray=n,Object.defineProperty(Array.prototype,"xEach",{value:t.utilTack(n)})}(Crisp),function(){function t(t,e,n){return void 0===n||0==+n?Math[t](e):(e=+e,n=+n,isNaN(e)||"number"!=typeof n||n%1!=0?NaN:(e=e.toString().split("e"),e=Math[t](+(e[0]+"e"+(e[1]?+e[1]-n:-n))),+((e=e.toString().split("e"))[0]+"e"+(e[1]?+e[1]+n:n))))}Math.round10||(Math.round10=function(e,n){return t("round",e,n)}),Math.floor10||(Math.floor10=function(e,n){return t("floor",e,n)}),Math.ceil10||(Math.ceil10=function(e,n){return t("ceil",e,n)})}(Crisp),function(t){Number.isInteger=Number.isInteger||function(e){return t.type.call(e,"Number")&&isFinite(e)&&Math.floor(e)===e},Object.defineProperty(Number.prototype,"xMath",{value:t.math})}(Crisp),function(t){function e(t,e,r){var o,s,c=Object.keys(this),a=0,l=1,h=c.length,u=t.start?Number(t.start):0,f=void 0===t.limit?h:Number(t.limit);for(f<=0&&(f=h),u<0&&(u=h+u),u+f>h&&(f-=u+f-h),u<0&&(u=0,f=h),t.reverse&&(u-=h+(l=-1));a<f;a+=1)try{s=c[o=(a+u)*l],e.call(t.self,this[s],s,r)}catch(e){if(!(e instanceof n)){if(e instanceof i||o<0)return this;throw e}t.limit&&(t.reverse||o<h&&f<h)&&(f+=1)}return this}var n=t.ns("util.control.Break"),i=t.ns("util.control.End");t.xEachObject=e,Object.defineProperty(Object.prototype,"xEach",{value:t.utilTack(e)}),Object.defineProperty(Object.prototype,"xTo",{value:t.to}),Object.defineProperty(Object.prototype,"xType",{value:t.type}),Object.defineProperty(Object.prototype,"toURLParam",{value:function(){var e=[];return this.xEach({},function(n,i){var r="";r=t.type.call(n,"Object")?n.xTo():t.type.call(n,"Array")?n.xTo():t.type.call(n,"Boolean")?n.xTo():n.toString(),r=i.concat("=",r),e.push(r)}),e.join("&")}})}(Crisp),function(t){var e=/[.*+?^${}()|[\]\\]/g;RegExp.escape=RegExp.escape||function(t){return t.replace(e,"\\$&")},Object.defineProperty(RegExp.prototype,"xTo",{value:function(){return t.to.call(this.toString())}})}(Crisp),function(t){Object.defineProperty(String.prototype,"toMath",{value:t.toMath}),Object.defineProperty(String.prototype,"xMath",{value:t.math}),Object.defineProperty(String.prototype,"xParse",{value:t.parse})}(Crisp),function(t){function e(t){if(this.prototype[t]&&-1===w.indexOf(t))throw new Error("Redefined prototype "+t);if(this.hasOwnProperty(t))throw new Error("Can't overwride prototype."+t+" with property!")}function n(t,n){e.call(this,n),this.prototype[n]=t}function i(t){t.xEach({self:this},n)}function r(t){t.xEach({self:this},i)}function o(t,e){var n={};void 0!==e.proEnu&&(n.enumerable=e.proEnu),void 0!==e.proCon&&(n.configurable=e.proCon),void 0!==e.proWri&&(n.writable=e.proWri),void 0!==e.proVal?n.value=e.proVal:void 0===e.proGet&&void 0===e.proSet||(n.get=e.proGet,n.set=e.proSet),Object.defineProperty(this,t,n)}function s(t){return g.concat(t,g)}function c(t,e){if(!this.hasOwnProperty(t))throw new Error("set Option: Property '"+t+"' not defined!");return this[t]=e,this}function a(t,e){c.call(this,s(e),t)}function l(t){t.xEach({self:this},a)}function h(t){return[].xAdd(t).xEach({self:this},l),this}function u(t,e){var n=this[t];return void 0===n&&(n="function"==typeof e.preset?e.preset.call(this):e.preset,e.insert&&c.call(this,t,n)),n}function f(t,e){o.call(this,e,t)}function p(t){t.xEach({self:this},f)}function d(t){t.xEach({self:this},p)}function v(t,e){o.call(this,s(e),t)}function _(t){t.xEach({self:this},v)}function y(t){t.xEach({self:this},_)}function x(t,e){var n=this.data[e];void 0!==n&&(this.obj[e]=n)}function m(e){var n=t.ns(e);this.op.xAdd(n.options),this.pp.xAdd(n.properties),this.pt.xAdd(n.prototypes)}var g="__",w=["toString","valueOf"],k={};t.utilProperty=o,t.ns("util.create").prototypes={objIni:function(t){var e=this._("create");return y.call(this,e.options),d.call(this,e.properties),h.call(this,t)},_:function(e){var n,i;return t.type.call(e,"String")?this[s(e)]:(i=s(e.name),n=u.call(this,i,e),e.after&&c.call(this,i,n+e.after),e.before&&c.call(this,i,n+=e.before),n)},objSet:function(t,e){return c.call(this,s(t),e)},objData:function(t){return(this.objNs("util.props")?this:t).xEach({self:{obj:this,data:t}},x),this},objClone:function(){function t(){}return t.prototype=this,new t},objNs:function(t){return-1!==this._("create").ns.indexOf(t)}},t.utilCreate=function(t){var e,n,i,c;return t=t||{},k[t.once]?k[t.once].objClone():(e=t.base||function(){},n={op:[],pp:[],pt:[]},i=["util.create"].xAdd(t.ns).xEach({self:n},m),r.call(e,n.pt.xAdd(t.prototypes)),c=new e,o.call(c,s("create"),{proVal:{ns:i,options:n.op.xAdd(t.options),properties:n.pp.xAdd(t.properties)}}),t.once?(k[t.once]=c,c.objClone()):c)}}(Crisp),function(t){function e(t){var e;if(void 0!==t)return m.call(t,"RegExp")?t:((e=t.split(" ")).map(function(t){return x(t)}),new RegExp("(^|\\s)("+e.join("|")+")($|\\s|\\.)"))}function n(t){var e;if(void 0!==t)return m.call(t,"RegExp")?t:((e=t.split(" ")).map(function(t){return x(t)}),new RegExp("^("+e.join("|")+")$"))}function i(){this._list={}}function r(t,e,n,r,o,s){this.self=t,this.action=n,this.path=o,this.repeat=!0,this.picker=e,this._treat=r,this._empty=s,this._wait=1,this._note=new i}function o(t){this._listen=t.listen,this._self=t.self,this._async=t.async,this._action=e(t.action),this._path=n(t.path),this._noteAction=e(t.noteAction),this._notePath=n(t.notePath),this._noteList=t.noteList||k}function s(){this._listener=[]}function c(t){return t=t||{},t.event=t.event||E,t.parent=t.parent||T,t}function a(t,e){return e=c(e),t.hasOwnProperty(e.event)&&t[e.event]instanceof s}function l(t,e){return t.self=t.self||this,e.add(t)}function h(t,e,n){return t=t||{},t.self=t.self||this,e.trigger(t),t.repeat&&n&&m.call(n.eventTrigger,"Function")&&n.eventTrigger(t),this}function u(t){var e,n,i;return n=t.cache.picker=t.cache.picker||{},e=t.action||b,i=e.split(".")[0],n[i]instanceof r?n[i].Wait():(!t.path&&m.call(this.docPath,"Function")&&(t.path=this.docPath()),n[i]=new r(this,n,e,i,t.path,t.empty))}function f(t,e){return e.remove(t),this}function p(t,e){var n,i;if(!t||!a(t))return this;for(var r=0,o=(n=t._("event")._listener).length;r<o;r+=1)(i=n[r])._self===t&&(i._self=this),e._listener.push(i);return this}function d(t,e,n,i,r){t.call(e,n,i,r),r.Talk()}function v(t,e,n,i,r){var o,s;o=e.eventPicker({cache:n,action:"task.doc."+r}),s=e.eventPicker({cache:n,action:"changed.doc."+r}),t.call(e,n,i,function(t){if(t instanceof g)throw o.End(),s.End(),t;e.eventTrigger(t),o.Note(t),s.Note(t)}),o.Talk(),s.Talk()}var _=t.nextTick,y=t.utilTick,x=RegExp.escape,m=t.type,g=t.ns("util.control.Break"),w=t.ns("util.control.Noop"),k="own",b="task",E="__event__",T="__parent__";i.prototype={List:function(t){return t=t||k,this._list[t]=this._list[t]||[]},Length:function(t){var e,n=0;if(void 0!==t);else for(e in this._list)n+=this._list[e].length;return n},Empty:function(t){return 0===this.Length(t)},Add:function(t,e){this.List(t.type||e).push(t)}},r.prototype={Wait:function(){return this._wait+=1,this},Talk:function(){return this._wait-=1,this._wait>0||!this._empty&&this._note.Empty()?this:this.End()},End:function(){return this._wait=0,delete this.picker[this._treat],this.self.eventTrigger(this),this},Note:function(t,e){return this._note.Add(t,e),this},List:function(t){return this._note.List(t)},Test:function(t){var e=0;return this._note.List(t._noteList).forEach(function(n){var i=0;t._notePath&&!t._notePath.test(n.path)&&(i+=1),t._noteAction&&!t._noteAction.test(n.action)&&(i+=1),0===i&&(e+=1)}),0===e}},o.prototype={talk:function(t){this._self!==t.exporter&&(this._action&&!this._action.test(t.action)||this._path&&!this._path.test(t.path)||(!this._notePath&&!this._noteAction||t instanceof r&&!t.Test(this))&&y(this._self,this._listen,t,this._async))},is:function(t){var n;return n=this._action&&t.action?this._action.toString()===e(t.action).toString():void 0===this._action||void 0===t.action,this._listen===t.listen&&n}},s.prototype={add:function(t){for(var e,n=this._listener,i=0,r=n.length;i<r;i+=1)if(n[i].is(t))return n[i];return e=new o(t),n.push(e),e},trigger:function(t){for(var e=this._listener,n=0,i=e.length;n<i;n+=1)e[n].talk(t);return this},remove:function(t){for(var e=this._listener,n=0,i=e.length;n<i;n+=1)if(e[n]===t){e.splice(n,1);break}return this}},t.hasOwnEvent=a;var P={name:"event",preset:function(){return new s},insert:!0},O={name:"parent",preset:{}},j={proWri:!0};t.ns("util.event").options={event:j},t.ns("util.event").prototypes={eventListener:function(t){return l.call(this,t,this._(P))},eventTrigger:function(t){return h.call(this,t,this._(P),this._(O))},eventPicker:u,eventRemove:function(t){return f.call(this,t,this._(P))},eventResettle:function(t){return p.call(this,t,this._(P))}},t.defineEvent=function(t,e){return e=c(e),Object.defineProperty(t,e.event,{writabel:!0,value:new s}),Object.defineProperties(t,{eventListener:{value:function(t){return l.call(this,t,this[e.event])}},eventTrigger:{value:function(t){return h.call(this,t,this[e.event],this[e.parent])}},eventPicker:{value:u},eventRemove:{value:function(t){return f.call(this,t,this[e.event])}},eventResettle:{value:function(t){return p.call(this,t,this[e.event])}}}),t},t.utilPick=function(e,n){function i(n,i,r){var o,s={};return i=i||w,t.defineEvent(s),r&&s.eventListener({self:this,listen:r}),o=s.eventPicker({cache:{},empty:!0}),n.async?_(d,e,this,n,i,o):(e.call(this,n,i,o),o.Talk()),this}return Object.defineProperty(i,"tick",{value:n||!0}),Object.defineProperty(i,"callback",{value:e}),i},t.utilTask=function(t,e,n){function i(n,i){var r;return i=i||w,n.async&&(r=n.async,delete n.async),r?_(v,t,this,n,i,e):v(t,this,n,i,e),this}return Object.defineProperty(i,"task",{value:n||!0}),Object.defineProperty(i,"callback",{value:t}),i}}(Crisp),function(t){function e(){}function n(){}function i(t,e,n){var i=S.call(t.itemEach,"Function")?t.itemEach:t.xEach,r=this;n=n||function(t){b.call(this,t,null,e)},i.callback.call(t,{self:this,reverse:this._revlist},function(){n.apply(r,arguments)})}function r(t,e){this.child&&this.child.exec({node:t},e),(S.call(t,"Array")||S.call(t,"Object"))&&(t.isField&&t.isField()||i.call(this,t,e,function(t){M["#"].call(this,t,e)}))}function o(t){return S.call(t,"Function")}function s(e,n,i,r){if(e){var o={};t.defineEvent(o),o.eventListener({self:this,action:"success",listen:i}),o.eventListener({self:this,action:"complete",listen:r}),e.exec({node:n},o)}}function c(t){var e,n,i,r,o=new l(this,t);for(r=i=o.add(1),B.lastIndex=this._index;!n&&(e=B.exec(this._path));)this._index=B.lastIndex,I+=1,void 0!==e[1]?(r._operator=e[1],r=r.value=o.add()):void 0!==e[2]?r._reverse=e[2].length:void 0!==e[3]?(i._next=e[3],r=i=o.add(1)):void 0!==e[4]?r.child=c.call(this,r):void 0!==e[5]?n=!0:void 0!==e[6]?r.child=new k(r,Number(e[6])):void 0!==e[7]?r.child=new k(r,"true"===e[7]):void 0!==e[8]?r.child=new k(r,e[8].replace(L,'"')):void 0!==e[9]?r.child=new k(r,e[9].replace(R,"'")):void 0!==e[10]?r.child=new k(r,new RegExp(e[10],e[11])):void 0!==e[12]?r.child=new k(r,this._values,e[12]):(this._index=e.index,r.parse()),B.lastIndex=this._index;return o}function a(){}function l(t,e){e||(this._reason=t),this._parent=e,this.condition=[]}function h(t,e,n){S.call(e,"Undefined")||"false"===e||!1===e||S.call(e,"Boolean")&&!e.valueOf()?u.call(this,t,!0,n):S.call(e.isBoolean,"Function")?e.isBoolean.tick||u.call(this,t,e.isBoolean()&&!e.valueOf()||!e,n):u.call(this,t,!e,n)}function u(t,e,n){t>0?(t-=1,h.apply(this,arguments)):n.call(this,e)}function f(t,e,n,i,r){if(!t)return i.call(this,e),void r.call(this);s.call(this,this.value,n,function(n){n instanceof RegExp&&(e=n.test(e),n=!0),e=F[t](e,n),i.call(this,e)},r)}function p(t){this._parent=t}function d(t){var e;U.lastIndex=this._index;var n=U.exec(this._path);if(!n)return new x(t);if(this._index=U.lastIndex,void 0!==n[1])e=new y(t).parse();else if(void 0!==n[3])(e=new _(t,n[3]).parse())._revlist=n[2];else if(void 0!==n[4])e=new x(t,n[4]).parse();else if(void 0!==n[6])(e=new m(t,n[6]).parse())._revlist=n[5];else if(void 0!==n[7])(e=new x(t,this.valueKey(n[7])).parse())._valkey=n[7];else if(void 0!==n[8])e=g.call(this,t);else{if(void 0===n[9])return void(this._index=n.index);e=new v(t).parse()}return e}function v(t){this._parent=t}function _(t,e){this._parent=t,D.test(e)?(e=D.exec(e),this._start=e[1],this._limit=e[2]):this._start=e}function y(t){this._parent=t}function x(t,e){Object.defineProperty(this,"_parent",{value:t}),this._attr=e}function m(t,e){this._parent=t,this._type=e}function g(t){var e,n;if(t instanceof w||(n=new w(t)),q.lastIndex=this._index,!(e=q.exec(this._path)))return n;if(this._index=q.lastIndex,void 0!==e[1])n=new w(t);else{if(void 0===e[2])return this._index=e.index,n;n=new w(t,e[2]),e[3]&&e[3].length>0&&(n._args=JSON.parse("["+e[3].replace(H,"$1")+"]"))}return n.parse()}function w(t,e){this._parent=t,this._name=e}function k(t,e,n){this._parent=t,this._value=e,this._key=n}function b(t,e,i){var r;if(this.child)this.child.exec({node:t},i);else{var o=this.reason();if(!((o._count+=1)<=o._start)){try{i.eventTrigger({action:"success",args:[t]})}catch(t){if(!(t instanceof A))throw t;r=!0}if(r||-1!==o._limit&&o._count>=o._limit)throw i.eventPicker({cache:i,action:"complete",empty:!0}).End(),new n}}}function E(t,e){var i=c.call(t);try{i.exec({node:this},e)}catch(i){if(i instanceof n)return;if(void 0!==t._preset)return void e.eventTrigger({action:"success",args:t._preset});if(i instanceof C)return;throw i}}function T(t){this._path=t.path,this._values=t.values,this._preset=t.preset,this._limit=t.limit,this._start=t.start,this._async=t.async,this._count=0,this._index=0}function P(t){var e;return(t=t||"").xType("String")&&(t={path:t}),t.limit=1,t.async=!1,t.success=function(t){e=t},this.pathFind(t),S.call(e,"Undefined")&&(e=S.call(t.preset,"Function")?t.preset.call(this):t.preset),e}function O(e,n,i){var r;e=e||{},n=n||e.success,i=i||e.complete,r=e.self||this,e.limit=e.limit||-1,e.start=e.start||0,e.values=e.values||{},e.values.self=e.values.self||this,e.values.root=e.values.root||function(){return this.rootSelf()};var s=new T(e);s.level=0;var c={};return t.defineEvent(c),o(n)&&c.eventListener({action:"success",self:r,listen:n}),o(i)&&c.eventListener({action:"complete",self:r,listen:i}),N(this,E,[s,c],e.async),this}function j(t){return void 0!==this.pathNode({path:t})}var N=t.utilTick,S=t.type,A=t.ns("util.control.Break"),C=t.ns("util.control.End"),L=/\\"/g,R=/\\'/g,F={">":function(t,e){return t>e},"<":function(t,e){return t<e},">=":function(t,e){return t>=e},"<=":function(t,e){return t<=e},"==":function(t,e){return t===e},"!=":function(t,e){return t!==e}},M={"*":function(t,n){var r=this.specific();i.call(this,t,n,function(t){if(r)try{s.call(this,r,t,function(i){if(!i)throw new e;this.child.exec({node:t},n)},C)}catch(t){if(t instanceof e)throw new A}else this.child.exec({node:t},n)})},"+":function(t,e){this.child&&(this._specific=this.child.filter),b.call(this.child,t,null,e)},"#":function(t,e){var n=this.specific();n?s.call(this,n,t,function(n){n&&r.call(this,t,e)},C):r.call(this,t,e)}},B=new RegExp('\\s*(?:(\\!=|[<>=]{1,2})|(\\!+)|(&|\\|)|(\\[|\\()|(\\]|\\))\\.?|(-?\\d+(?:\\.\\d+)?)(?![\\.:~\\d])|(true|false)|"((?:[^"\\\\]*|\\\\"|\\\\)*)"|'+"'((?:[^'\\\\]*|\\\\'|\\\\)*)'|\\/((?:[^\\/\\\\]*|\\\\\\/|\\\\)+)\\/([igm]{1,3})?|\\$([\\w]+)\\s?(?![\\w\\.:])|.+)\\s*","g"),I=0;a.prototype={parent:function(t){return t?this._parent&&o(this._parent[t])&&this._parent[t]():this._parent},reason:function(){return this._reason||this.parent("reason")},specific:function(){if(null!==this._specific)return this._specific||this.parent("specific")}};var $=l.prototype=new a;$.add=function(t){var e=new p(this);return t&&this.condition.push(e),e},$.exec=function(t,e){var n=e.eventPicker({cache:e,action:"complete",empty:!0});this.condition.xEach({self:this},function(i){n.Wait(),i.next("&")?s.call(this,i,t.node,function(t){if(!t)throw n.Talk(),new C},function(){n.Talk()}):i.next("|")?s.call(this,i,t.node,function(t){if(t)throw b.call(this,t,n,e),n.Talk(),new C},function(){n.Talk()}):(i.exec({node:t.node},e),n.Talk())},function(){n.Talk()})};var W=p.prototype=new a;W.parse=function(){return this.child=d.call(this.reason(),this),this},W.exec=function(t,e){var n=e.eventPicker({cache:e,action:"complete",empty:!0});if(!this.reverse()&&!this.operator())return b.call(this,t.node,n,e),void n.Talk();s.call(this,this.child,t.node,function(i){u.call(this,this.reverse(),i,function(i){n.Wait(),f.call(this,this.operator(),i,t.node,function(t){e.eventTrigger({action:"success",args:t})},function(){n.Talk()})})},function(){n.Talk()})},W.reverse=function(){return this._reverse||0},W.operator=function(){return this._operator||0},W.next=function(t){return t?this._next===t:this._next};var U=new RegExp("\\s*(?:(\\.)|(\\^)?(-?\\d*~\\d*|-\\d+)\\.?|(\\d+|[a-z_][a-z\\d\\-_]*)\\.?|(\\^)?([*#+])\\.?|\\$([a-z\\d_]+)\\.?|(:)|(\\[|\\()|.+)\\s*","g"),z=v.prototype=new a;z.parse=function(){return this.filter=c.call(this.reason(),this),this.child=d.call(this.reason(),this),this},z.exec=function(t,e){var n=t.node,i=e.eventPicker({cache:e,action:"complete",empty:!0}),r=this;s.call(this,this.filter,n,function(t){t&&b.call(r,n,i,e)},function(){i.Talk()})};var D=/^(-?\d+)?~(\d+)?$/,J=_.prototype=new a;J.parse=function(){return this.child=d.call(this.reason(),this),this},J.exec=function(t,n){var i,r=n.eventPicker({cache:n,action:"complete",empty:!0}),o={self:this,reverse:this._revlist};S.call(t.node.itemLimit,"Function")?(o.start=this._start,o.limit=this._limit,i=t.node.itemLimit):(o.start=this._start||0,o.limit=this._limit||10,i=t.node.xEach),i.callback.call(t.node,o,function(t){var i=this.specific();if(i)try{s.call(this,i,t,function(i){if(!i)throw new e;b.call(this,t,null,n)},function(){})}catch(t){if(t instanceof e)throw new A}else b.call(this,t,null,n)}),r.Talk()};var V=y.prototype=new a;V.parse=function(){return this.child=d.call(this.reason(),this),this},V.exec=function(t,e){b.call(this,t.node.__parent__,null,e)};var G=x.prototype=new a;G.parse=function(){return this.child=d.call(this.reason(),this),this},G.exec=function(t,e){var n=this,i=e.eventPicker({cache:e,action:"complete",empty:!0});if(!S.call(n.attr(),"Undefined")&&S.call(t.node.itemFetch,"Function"))return t.node.itemFetch({name:n.attr()},function(t){b.call(n,t,i,e)},function(){i.Talk()});S.call(t.node,"Object")&&-1!==Object.keys(t.node).indexOf(n.attr())||S.call(t.node,"Array")&&t.node[n.attr()]?b.call(n,t.node[n.attr()],i,e):n._valkey?t.node=n.child.exec({node:n.attr()},e):n.attr()||b.call(n,t.node,i,e),i.Talk()},G.attr=function(){return this._attr};var K=m.prototype=new a;K.parse=function(){return this.child=d.call(this.reason(),this),this},K.exec=function(t,e){M[this.type()].call(this,t.node,e)},K.type=function(){return this._type};var q=new RegExp("(?:(\\.)|(\\w+)(?:\\(((?:[^)\\\\]*|\\\\\\)|\\\\)+)\\))?\\.?)\\s*|.+","g"),H=/\\([\(\)])/g,Q=w.prototype=new a;Q.parse=function(){return this.child=g.call(this.reason(),this),this},Q.exec=function(e,n){var i,r,s=this,c=e.node[this.name()];if(o(c)){if(r=n.eventPicker({cache:n,action:"complete",empty:!0}),!c.tick)return e.node=c.apply(e.node,this.args()),b.call(this,e.node,r,n),void r.Talk();i=t.callSchema(c.schema||c.tick,this.args()),c.call(e.node,i,function(t){b.call(s,t,r,n)},function(){r.Talk()},r)}},Q.name=function(){return this._name||"toString"},Q.args=function(){return[].xAdd(this._args)},(k.prototype=new a).exec=function(t,e){var n=e.eventPicker({cache:e,action:"complete",empty:!0}),i=this._key?this._value[this._key]:this._value;b.call(this,i,n,e),n.Talk()},T.prototype={valueKey:function(t){var e=this._values[t];return S.call(e,"Function")?e.call(this):e},rootSelf:function(){for(var t=this._values.self;t.__parent__;)t=t.__parent__;return t}},t.ns("util.path").prototypes={pathNode:P,pathFind:O,pathExists:j},t.definePath=function(t){Object.defineProperties(t,{pathNode:{value:P},pathFind:{value:O},pathExists:{value:j}})}}(Crisp);