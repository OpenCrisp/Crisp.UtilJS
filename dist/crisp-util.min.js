/*! OpenCrisp UtilJS - v0.3.0 - 2016-10-07
* https://github.com/OpenCrisp/Crisp.UtilJS
* Copyright (c) 2016 Fabian Schmid; Licensed [object Object] */
!function(a){function b(a){var b=e.call(a).replace(f,"$1");return g.indexOf(b)!==-1&&(b=n),b}function c(a,d){return"field"===d?c(a,m)||c(a,k)||c(a,h)||c(a,i)||c(a,l):b(a)===d}function d(a,b,d){var e=d.args;void 0===e&&(e=d),e=[].concat(e),a.apply(b,e),c(d.complete,j)&&d.complete.apply(b,e)}var e=Object.prototype.toString,f=/^\[object ([a-z]+)\]$/i,g=["global","Null","DOMWindow","Window"],h="Boolean",i="Date",j="Function",k="Number",l="RegExp",m="String",n="Undefined";a.Crisp={ns:function(a,b){var d,e=a.split("."),f=this;d=e.length-1;for(var g=0,h=d;g<h;g+=1)f[e[g]]=f[e[g]]||{},f=f[e[g]];if(b){if(!c(f[e[d]],n))throw new Error("Can't overwrite '"+a+"' of defined!");f[e[d]]=b}else c(f[e[d]],n)&&(f[e[d]]={});return f[e[d]]},utilTick:function(b,c,e,f){return e=e||{},b=b||e.self,e.async&&(f=!0,delete e.async),f?(a.Crisp.nextTick(d,c,b,e),b):(d(c,b,e),b)},to:function(){return JSON.stringify(this)},parse:function(){return JSON.parse(this.toString())},type:function(a){return a?c(this,a):b(this)},math:function(a){var b=[this];return arguments.xEach({start:1},function(a){b.push(a)}),Math[a].apply(Math,b)}}}("undefined"!=typeof process&&"undefined"!=typeof process.title&&"undefined"!=typeof global?global:window),function(a){a.ns("util.control.Break",function(){}),a.ns("util.control.End",function(){}),a.ns("util.control.Noop",function(){})}(Crisp),function(a){function b(a,b,c,d,e){a.call(b,c,d),e.call(b,c)}function c(a,c){function d(c,d,g){var h;return c.async&&(h=c.async,delete c.async),d=d||c.success||e,g=g||c.complete||e,h?f(b,a,this,c,d,g):(a.call(this,c,d),g.call(this,c)),this}return Object.defineProperty(d,"tick",{value:c||!0}),Object.defineProperty(d,"callback",{value:a}),d}function d(a,b){var c,d={};if(Crisp.type.call(b[0],"Object"))return b[0];a=a||[];for(var e=0,f=b.length;e<f;e+=1)c=a[e]||e,d[c]=b[e];return d}var e=a.ns("util.control.Break"),f=function(){return"object"==typeof process&&"function"==typeof process.nextTick?process.nextTick:"function"==typeof setImmediate?setImmediate:function(a){return setTimeout.apply(null,[a,0].concat(Array.prototype.slice.call(arguments).slice(1)))}}();a.nextTick=f,a.utilTack=c,a.callSchema=d}(Crisp),function(a){function b(){for(var c,d=0,e=arguments.length;d<e;d+=1)c=arguments[d],a.type.call(c,"Array")?b.apply(this,c):void 0!==c&&this.push(c);return this}function c(a,b,c){var f,g=0,h=1,i=this.length,j=a.start?Number(a.start):0,k=void 0===a.limit?i:Number(a.limit);for(k<=0&&(k=i),j<0&&(j=i+j),j+k>i&&(k-=j+k-i),j<0&&(j=0,k=i),a.reverse&&(h=-1,j-=i+h);g<k;g+=1)try{f=(g+j)*h,b.call(a.self,this[f],f,c)}catch(b){if(!(b instanceof d)){if(b instanceof e||f<0)return this;throw b}a.limit&&(a.reverse||f<i&&k<i)&&(k+=1)}return this}var d=a.ns("util.control.Break"),e=a.ns("util.control.End");Object.defineProperty(Array.prototype,"xAdd",{value:b}),a.xEachArray=c,Object.defineProperty(Array.prototype,"xEach",{value:a.utilTack(c)})}(Crisp),function(){function a(a,b,c){return"undefined"==typeof c||0===+c?Math[a](b):(b=+b,c=+c,isNaN(b)||"number"!=typeof c||c%1!==0?NaN:(b=b.toString().split("e"),b=Math[a](+(b[0]+"e"+(b[1]?+b[1]-c:-c))),b=b.toString().split("e"),+(b[0]+"e"+(b[1]?+b[1]+c:c))))}Math.round10||(Math.round10=function(b,c){return a("round",b,c)}),Math.floor10||(Math.floor10=function(b,c){return a("floor",b,c)}),Math.ceil10||(Math.ceil10=function(b,c){return a("ceil",b,c)})}(Crisp),function(a){Number.isInteger=Number.isInteger||function(b){return a.type.call(b,"Number")&&isFinite(b)&&Math.floor(b)===b},Object.defineProperty(Number.prototype,"xMath",{value:a.math})}(Crisp),function(a){function b(a,b,e){var f,g,h=Object.keys(this),i=0,j=1,k=h.length,l=a.start?Number(a.start):0,m=void 0===a.limit?k:Number(a.limit);for(m<=0&&(m=k),l<0&&(l=k+l),l+m>k&&(m-=l+m-k),l<0&&(l=0,m=k),a.reverse&&(j=-1,l-=k+j);i<m;i+=1)try{f=(i+l)*j,g=h[f],b.call(a.self,this[g],g,e)}catch(b){if(!(b instanceof c)){if(b instanceof d||f<0)return this;throw b}a.limit&&(a.reverse||f<k&&m<k)&&(m+=1)}return this}var c=a.ns("util.control.Break"),d=a.ns("util.control.End");a.xEachObject=b,Object.defineProperty(Object.prototype,"xEach",{value:a.utilTack(b)}),Object.defineProperty(Object.prototype,"xTo",{value:a.to}),Object.defineProperty(Object.prototype,"xType",{value:a.type}),Object.defineProperty(Object.prototype,"toURLParam",{value:function(){var b=[];return this.xEach({},function(c,d){var e="";e=a.type.call(c,"Object")?c.xTo():a.type.call(c,"Array")?c.xTo():a.type.call(c,"Boolean")?c.xTo():c.toString(),e=d.concat("=",e),b.push(e)}),b.join("&")}})}(Crisp),function(a){var b=/[.*+?^${}()|[\]\\]/g;RegExp.escape=RegExp.escape||function(a){return a.replace(b,"\\$&")},Object.defineProperty(RegExp.prototype,"xTo",{value:function(){return a.to.call(this.toString())}})}(Crisp),function(a){Object.defineProperty(String.prototype,"toMath",{value:a.toMath}),Object.defineProperty(String.prototype,"xMath",{value:a.math}),Object.defineProperty(String.prototype,"xParse",{value:a.parse})}(Crisp),function(a){function b(a){if(this.prototype[a]&&v.indexOf(a)===-1)throw new Error("Redefined prototype "+a);if(this.hasOwnProperty(a))throw new Error("Can't overwride prototype."+a+" with property!")}function c(a,c){b.call(this,c),this.prototype[c]=a}function d(a){a.xEach({self:this},c)}function e(a){a.xEach({self:this},d)}function f(a,b){var c={};void 0!==b.proEnu&&(c.enumerable=b.proEnu),void 0!==b.proCon&&(c.configurable=b.proCon),void 0!==b.proWri&&(c.writable=b.proWri),void 0!==b.proVal?c.value=b.proVal:void 0===b.proGet&&void 0===b.proSet||(c.get=b.proGet,c.set=b.proSet),Object.defineProperty(this,a,c)}function g(a){return u.concat(a,u)}function h(a,b){if(!this.hasOwnProperty(a))throw new Error("set Option: Property '"+a+"' not defined!");return this[a]=b,this}function i(a,b){h.call(this,g(b),a)}function j(a){a.xEach({self:this},i)}function k(a){return[].xAdd(a).xEach({self:this},j),this}function l(a,b){var c=this[a];return void 0===c&&(c="function"==typeof b.preset?b.preset.call(this):b.preset,b.insert&&h.call(this,a,c)),c}function m(a,b){f.call(this,b,a)}function n(a){a.xEach({self:this},m)}function o(a){a.xEach({self:this},n)}function p(a,b){f.call(this,g(b),a)}function q(a){a.xEach({self:this},p)}function r(a){a.xEach({self:this},q)}function s(a,b){var c=this.data[b];void 0!==c&&(this.obj[b]=c)}function t(b){var c=a.ns(b);this.op.xAdd(c.options),this.pp.xAdd(c.properties),this.pt.xAdd(c.prototypes)}var u="__",v=["toString","valueOf"],w={};a.utilProperty=f,a.ns("util.create").prototypes={objIni:function(a){var b=this._("create");return r.call(this,b.options),o.call(this,b.properties),k.call(this,a)},_:function(b){var c,d;return a.type.call(b,"String")?this[g(b)]:(d=g(b.name),c=l.call(this,d,b),b.after&&h.call(this,d,c+b.after),b.before&&h.call(this,d,c+=b.before),c)},objSet:function(a,b){return h.call(this,g(a),b)},objData:function(a){return(this.objNs("util.props")?this:a).xEach({self:{obj:this,data:a}},s),this},objClone:function(){function a(){}return a.prototype=this,new a},objNs:function(a){return this._("create").ns.indexOf(a)!==-1}},a.utilCreate=function(a){var b,c,d,h;return a=a||{},w[a.once]?w[a.once].objClone():(b=a.base||function(){},c={op:[],pp:[],pt:[]},d=["util.create"].xAdd(a.ns).xEach({self:c},t),e.call(b,c.pt.xAdd(a.prototypes)),h=new b,f.call(h,g("create"),{proVal:{ns:d,options:c.op.xAdd(a.options),properties:c.pp.xAdd(a.properties)}}),a.once?(w[a.once]=h,h.objClone()):h)}}(Crisp),function(a){function b(a){var b;if(void 0!==a)return w.call(a,"RegExp")?a:(b=a.split(" "),b.map(function(a){return v(a)}),new RegExp("(^|\\s)("+b.join("|")+")($|\\s|\\.)"))}function c(a){var b;if(void 0!==a)return w.call(a,"RegExp")?a:(b=a.split(" "),b.map(function(a){return v(a)}),new RegExp("^("+b.join("|")+")$"))}function d(){this._list={}}function e(a,b,c,e,f,g){this.self=a,this.action=c,this.path=f,this.repeat=!0,this.picker=b,this._treat=e,this._empty=g,this._wait=1,this._note=new d}function f(a){this._listen=a.listen,this._self=a.self,this._async=a.async,this._action=b(a.action),this._path=c(a.path),this._noteAction=b(a.noteAction),this._notePath=c(a.notePath),this._noteList=a.noteList||z}function g(){this._listener=[]}function h(a){return a=a||{},a.event=a.event||B,a.parent=a.parent||C,a}function i(a,b){return b=h(b),a.hasOwnProperty(b.event)&&a[b.event]instanceof g}function j(a,b){return a.self=a.self||this,b.add(a)}function k(a,b,c){return a=a||{},a.self=a.self||this,b.trigger(a),a.repeat&&c&&w.call(c.eventTrigger,"Function")&&c.eventTrigger(a),this}function l(a){var b,c,d;return c=a.cache.picker=a.cache.picker||{},b=a.action||A,d=b.split(".")[0],c[d]instanceof e?c[d].Wait():(!a.path&&w.call(this.docPath,"Function")&&(a.path=this.docPath()),c[d]=new e(this,c,b,d,a.path,a.empty))}function m(a,b){return b.remove(a),this}function n(a,b){var c,d;if(!a||!i(a))return this;c=a._("event")._listener;for(var e=0,f=c.length;e<f;e+=1)d=c[e],d._self===a&&(d._self=this),b._listener.push(d);return this}function o(a,b){return b=h(b),Object.defineProperty(a,b.event,{writabel:!0,value:new g}),Object.defineProperties(a,{eventListener:{value:function(a){return j.call(this,a,this[b.event])}},eventTrigger:{value:function(a){return k.call(this,a,this[b.event],this[b.parent])}},eventPicker:{value:l},eventRemove:{value:function(a){return m.call(this,a,this[b.event])}},eventResettle:{value:function(a){return n.call(this,a,this[b.event])}}}),a}function p(a,b,c,d,e){a.call(b,c,d,e),e.Talk()}function q(b,c){function d(c,d,e){var f,g={};return d=d||y,a.defineEvent(g),e&&g.eventListener({self:this,listen:e}),f=g.eventPicker({cache:{},empty:!0}),c.async?t(p,b,this,c,d,f):(b.call(this,c,d,f),f.Talk()),this}return Object.defineProperty(d,"tick",{value:c||!0}),Object.defineProperty(d,"callback",{value:b}),d}function r(a,b,c,d,e){function f(a){if(a instanceof x)throw g.End(),h.End(),a;b.eventTrigger(a),g.Note(a),h.Note(a)}var g,h;g=b.eventPicker({cache:c,action:"task.doc."+e}),h=b.eventPicker({cache:c,action:"changed.doc."+e}),a.call(b,c,d,f),g.Talk(),h.Talk()}function s(a,b,c){function d(c,d){var e;return d=d||y,c.async&&(e=c.async,delete c.async),e?t(r,a,this,c,d,b):r(a,this,c,d,b),this}return Object.defineProperty(d,"task",{value:c||!0}),Object.defineProperty(d,"callback",{value:a}),d}var t=a.nextTick,u=a.utilTick,v=RegExp.escape,w=a.type,x=a.ns("util.control.Break"),y=a.ns("util.control.Noop"),z="own",A="task",B="__event__",C="__parent__";d.prototype={List:function(a){return a=a||z,this._list[a]=this._list[a]||[]},Length:function(a){var b,c=0;if(void 0!==a);else for(b in this._list)c+=this._list[b].length;return c},Empty:function(a){return 0===this.Length(a)},Add:function(a,b){this.List(a.type||b).push(a)}},e.prototype={Wait:function(){return this._wait+=1,this},Talk:function(){return this._wait-=1,this._wait>0||!this._empty&&this._note.Empty()?this:this.End()},End:function(){return this._wait=0,delete this.picker[this._treat],this.self.eventTrigger(this),this},Note:function(a,b){return this._note.Add(a,b),this},List:function(a){return this._note.List(a)},Test:function(a){var b=0;return this._note.List(a._noteList).forEach(function(c){var d=0;a._notePath&&!a._notePath.test(c.path)&&(d+=1),a._noteAction&&!a._noteAction.test(c.action)&&(d+=1),0===d&&(b+=1)}),0===b}},f.prototype={talk:function(a){this._self!==a.exporter&&(this._action&&!this._action.test(a.action)||this._path&&!this._path.test(a.path)||(!this._notePath&&!this._noteAction||a instanceof e&&!a.Test(this))&&u(this._self,this._listen,a,this._async))},is:function(a){var c;return c=this._action&&a.action?this._action.toString()===b(a.action).toString():void 0===this._action||void 0===a.action,this._listen===a.listen&&c}},g.prototype={add:function(a){for(var b,c=this._listener,d=0,e=c.length;d<e;d+=1)if(c[d].is(a))return c[d];return b=new f(a),c.push(b),b},trigger:function(a){for(var b=this._listener,c=0,d=b.length;c<d;c+=1)b[c].talk(a);return this},remove:function(a){for(var b=this._listener,c=0,d=b.length;c<d;c+=1)if(b[c]===a){b.splice(c,1);break}return this}},a.hasOwnEvent=i;var D={name:"event",preset:function(){return new g},insert:!0},E={name:"parent",preset:{}},F={proWri:!0};a.ns("util.event").options={event:F},a.ns("util.event").prototypes={eventListener:function(a){return j.call(this,a,this._(D))},eventTrigger:function(a){return k.call(this,a,this._(D),this._(E))},eventPicker:l,eventRemove:function(a){return m.call(this,a,this._(D))},eventResettle:function(a){return n.call(this,a,this._(D))}},a.defineEvent=o,a.utilPick=q,a.utilTask=s}(Crisp),function(a){function b(){}function c(){}function d(a,b,c){var d=E.call(a.itemEach,"Function")?a.itemEach:a.xEach,e=this;c=c||function(a){x.call(this,a,null,b)},d.callback.call(a,{self:this,reverse:this._revlist},function(){c.apply(e,arguments)})}function e(a,b){this.child&&this.child.exec({node:a},b),(E.call(a,"Array")||E.call(a,"Object"))&&(a.isField&&a.isField()||d.call(this,a,b,function(a){K["#"].call(this,a,b)}))}function f(a){return E.call(a,"Function")}function g(b,c,d,e){if(b){var f={};a.defineEvent(f),f.eventListener({self:this,action:"success",listen:d}),f.eventListener({self:this,action:"complete",listen:e}),b.exec({node:c},f)}}function h(a){var b,c,d,e,f=new j(this,a);for(e=d=f.add(1),M.lastIndex=this._index;!c&&(b=M.exec(this._path));)this._index=M.lastIndex,N+=1,void 0!==b[1]?(e._operator=b[1],e=e.value=f.add()):void 0!==b[2]?e._reverse=b[2].length:void 0!==b[3]?(d._next=b[3],e=d=f.add(1)):void 0!==b[4]?e.child=h.call(this,e):void 0!==b[5]?c=!0:void 0!==b[6]?e.child=new w(e,Number(b[6])):void 0!==b[7]?e.child=new w(e,"true"===b[7]):void 0!==b[8]?e.child=new w(e,b[8].replace(H,'"')):void 0!==b[9]?e.child=new w(e,b[9].replace(I,"'")):void 0!==b[10]?e.child=new w(e,new RegExp(b[10],b[11])):void 0!==b[12]?e.child=new w(e,this._values,b[12]):(this._index=b.index,e.parse()),M.lastIndex=this._index;return f}function i(){}function j(a,b){b||(this._reason=a),this._parent=b,this.condition=[]}function k(a,b,c){var d=E.call(b,"Undefined")||"false"===b||b===!1||E.call(b,"Boolean")&&!b.valueOf();d?l.call(this,a,!0,c):E.call(b.isBoolean,"Function")?b.isBoolean.tick||l.call(this,a,b.isBoolean()&&!b.valueOf()||!b,c):l.call(this,a,!b,c)}function l(a,b,c){a>0?(a-=1,k.apply(this,arguments)):c.call(this,b)}function m(a,b,c,d,e){return a?void g.call(this,this.value,c,function(c){c instanceof RegExp&&(b=c.test(b),c=!0),b=J[a](b,c),d.call(this,b)},e):(d.call(this,b),void e.call(this))}function n(a){this._parent=a}function o(a){var b;R.lastIndex=this._index;var c=R.exec(this._path);if(!c)return new s(a);if(this._index=R.lastIndex,void 0!==c[1])b=new r(a).parse();else if(void 0!==c[3])b=new q(a,c[3]).parse(),b._revlist=c[2];else if(void 0!==c[4])b=new s(a,c[4]).parse();else if(void 0!==c[6])b=new t(a,c[6]).parse(),b._revlist=c[5];else if(void 0!==c[7])b=new s(a,this.valueKey(c[7])).parse(),b._valkey=c[7];else if(void 0!==c[8])b=u.call(this,a);else{if(void 0===c[9])return void(this._index=c.index);b=new p(a).parse()}return b}function p(a){this._parent=a}function q(a,b){this._parent=a,T.test(b)?(b=T.exec(b),this._start=b[1],this._limit=b[2]):this._start=b}function r(a){this._parent=a}function s(a,b){Object.defineProperty(this,"_parent",{value:a}),this._attr=b}function t(a,b){this._parent=a,this._type=b}function u(a){var b,c;if(a instanceof v||(c=new v(a)),$.lastIndex=this._index,b=$.exec(this._path),!b)return c;if(this._index=$.lastIndex,void 0!==b[1])c=new v(a);else{if(void 0===b[2])return this._index=b.index,c;c=new v(a,b[2]),b[3]&&b[3].length>0&&(c._args=JSON.parse("["+b[3].replace(_,"$1")+"]"))}return c.parse()}function v(a,b){this._parent=a,this._name=b}function w(a,b,c){this._parent=a,this._value=b,this._key=c}function x(a,b,d){var e;if(this.child)return void this.child.exec({node:a},d);var f=this.reason();if(!((f._count+=1)<=f._start)){try{d.eventTrigger({action:"success",args:[a]})}catch(a){if(!(a instanceof F))throw a;e=!0}if(e||f._limit!==-1&&f._count>=f._limit)throw b=d.eventPicker({cache:d,action:"complete",empty:!0}),b.End(),new c}}function y(a,b){var d=h.call(a);try{d.exec({node:this},b)}catch(d){if(d instanceof c)return;if(void 0!==a._preset)return void b.eventTrigger({action:"success",args:a._preset});if(d instanceof G)return;throw d}}function z(a){this._path=a.path,this._values=a.values,this._preset=a.preset,this._limit=a.limit,this._start=a.start,this._async=a.async,this._count=0,this._index=0}function A(a){var b;return a=a||"",a.xType("String")&&(a={path:a}),a.limit=1,a.async=!1,a.success=function(a){b=a},this.pathFind(a),E.call(b,"Undefined")&&(b=E.call(a.preset,"Function")?a.preset.call(this):a.preset),b}function B(b,c,d){var e;b=b||{},c=c||b.success,d=d||b.complete,e=b.self||this,b.limit=b.limit||-1,b.start=b.start||0,b.values=b.values||{},b.values.self=b.values.self||this,b.values.root=b.values.root||function(){return this.rootSelf()};var g=new z(b);g.level=0;var h={};return a.defineEvent(h),f(c)&&h.eventListener({action:"success",self:e,listen:c}),f(d)&&h.eventListener({action:"complete",self:e,listen:d}),D(this,y,[g,h],b.async),this}function C(a){return void 0!==this.pathNode({path:a})}var D=a.utilTick,E=a.type,F=a.ns("util.control.Break"),G=a.ns("util.control.End"),H=/\\"/g,I=/\\'/g,J={">":function(a,b){return a>b},"<":function(a,b){return a<b},">=":function(a,b){return a>=b},"<=":function(a,b){return a<=b},"==":function(a,b){return a===b},"!=":function(a,b){return a!==b}},K={"*":function(a,c){var e=this.specific();d.call(this,a,c,function(a){if(e)try{g.call(this,e,a,function(d){if(!d)throw new b;this.child.exec({node:a},c)},G)}catch(a){if(a instanceof b)throw new F}else this.child.exec({node:a},c)})},"+":function(a,b){this.child&&(this._specific=this.child.filter),x.call(this.child,a,null,b)},"#":function(a,b){var c=this.specific();c?g.call(this,c,a,function(c){c&&e.call(this,a,b)},G):e.call(this,a,b)}},L='\\s*(?:(\\!=|[<>=]{1,2})|(\\!+)|(&|\\|)|(\\[|\\()|(\\]|\\))\\.?|(-?\\d+(?:\\.\\d+)?)(?![\\.:~\\d])|(true|false)|"((?:[^"\\\\]*|\\\\"|\\\\)*)"|'+"'((?:[^'\\\\]*|\\\\'|\\\\)*)'|\\/((?:[^\\/\\\\]*|\\\\\\/|\\\\)+)\\/([igm]{1,3})?|\\$([\\w]+)\\s?(?![\\w\\.:])|.+)\\s*",M=new RegExp(L,"g"),N=0;i.prototype={parent:function(a){return a?this._parent&&f(this._parent[a])&&this._parent[a]():this._parent},reason:function(){return this._reason||this.parent("reason")},specific:function(){if(null!==this._specific)return this._specific||this.parent("specific")}};var O=j.prototype=new i;O.add=function(a){var b=new n(this);return a&&this.condition.push(b),b},O.exec=function(a,b){var c=b.eventPicker({cache:b,action:"complete",empty:!0});this.condition.xEach({self:this},function(d){return c.Wait(),d.next("&")?void g.call(this,d,a.node,function(a){if(!a)throw c.Talk(),new G},function(){c.Talk()}):d.next("|")?void g.call(this,d,a.node,function(a){if(a)throw x.call(this,a,c,b),c.Talk(),new G},function(){c.Talk()}):(d.exec({node:a.node},b),void c.Talk())},function(){c.Talk()})};var P=n.prototype=new i;P.parse=function(){return this.child=o.call(this.reason(),this),this},P.exec=function(a,b){var c=b.eventPicker({cache:b,action:"complete",empty:!0});return this.reverse()||this.operator()?void g.call(this,this.child,a.node,function(d){l.call(this,this.reverse(),d,function(d){c.Wait(),m.call(this,this.operator(),d,a.node,function(a){b.eventTrigger({action:"success",args:a})},function(){c.Talk()})})},function(){c.Talk()}):(x.call(this,a.node,c,b),void c.Talk())},P.reverse=function(){return this._reverse||0},P.operator=function(){return this._operator||0},P.next=function(a){return a?this._next===a:this._next};var Q="\\s*(?:(\\.)|(\\^)?(-?\\d*~\\d*|-\\d+)\\.?|(\\d+|[a-z_][a-z\\d\\-_]*)\\.?|(\\^)?([*#+])\\.?|\\$([a-z\\d_]+)\\.?|(:)|(\\[|\\()|.+)\\s*",R=new RegExp(Q,"g"),S=p.prototype=new i;S.parse=function(){return this.filter=h.call(this.reason(),this),this.child=o.call(this.reason(),this),this},S.exec=function(a,b){var c=a.node,d=b.eventPicker({cache:b,action:"complete",empty:!0}),e=this;g.call(this,this.filter,c,function(a){a&&x.call(e,c,d,b)},function(){d.Talk()})};var T=/^(-?\d+)?~(\d+)?$/,U=q.prototype=new i;U.parse=function(){return this.child=o.call(this.reason(),this),this},U.exec=function(a,c){function d(a){var d=this.specific();if(d)try{g.call(this,d,a,function(d){if(!d)throw new b;x.call(this,a,null,c)},function(){})}catch(a){if(a instanceof b)throw new F}else x.call(this,a,null,c)}var e,f=c.eventPicker({cache:c,action:"complete",empty:!0}),h={self:this,reverse:this._revlist};E.call(a.node.itemLimit,"Function")?(h.start=this._start,h.limit=this._limit,e=a.node.itemLimit):(h.start=this._start||0,h.limit=this._limit||10,e=a.node.xEach),e.callback.call(a.node,h,d),f.Talk()};var V=r.prototype=new i;V.parse=function(){return this.child=o.call(this.reason(),this),this},V.exec=function(a,b){x.call(this,a.node.__parent__,null,b)};var W=s.prototype=new i;W.parse=function(){return this.child=o.call(this.reason(),this),this},W.exec=function(a,b){var c=this,d=b.eventPicker({cache:b,action:"complete",empty:!0});return!E.call(c.attr(),"Undefined")&&E.call(a.node.itemFetch,"Function")?a.node.itemFetch({name:c.attr()},function(a){x.call(c,a,d,b)},function(){d.Talk()}):(E.call(a.node,"Object")&&Object.keys(a.node).indexOf(c.attr())!==-1||E.call(a.node,"Array")&&a.node[c.attr()]?x.call(c,a.node[c.attr()],d,b):c._valkey?a.node=c.child.exec({node:c.attr()},b):c.attr()||x.call(c,a.node,d,b),void d.Talk())},W.attr=function(){return this._attr};var X=t.prototype=new i;X.parse=function(){return this.child=o.call(this.reason(),this),this},X.exec=function(a,b){K[this.type()].call(this,a.node,b)},X.type=function(){return this._type};var Y="(?:[^)\\\\]*|\\\\\\)|\\\\)+",Z="(?:(\\.)|(\\w+)(?:\\(("+Y+")\\))?\\.?)\\s*|.+",$=new RegExp(Z,"g"),_=/\\([\(\)])/g,aa=v.prototype=new i;aa.parse=function(){return this.child=u.call(this.reason(),this),this},aa.exec=function(b,c){function d(a){x.call(i,a,h,c)}function e(){h.Talk()}var g,h,i=this,j=b.node[this.name()];if(f(j)){if(h=c.eventPicker({cache:c,action:"complete",empty:!0}),!j.tick)return b.node=j.apply(b.node,this.args()),x.call(this,b.node,h,c),void h.Talk();g=a.callSchema(j.schema||j.tick,this.args()),j.call(b.node,g,d,e,h)}},aa.name=function(){return this._name||"toString"},aa.args=function(){return[].xAdd(this._args)};var ba=w.prototype=new i;ba.exec=function(a,b){var c=b.eventPicker({cache:b,action:"complete",empty:!0}),d=this._key?this._value[this._key]:this._value;x.call(this,d,c,b),c.Talk()},z.prototype={valueKey:function(a){var b=this._values[a];return E.call(b,"Function")?b.call(this):b},rootSelf:function(){for(var a=this._values.self;a.__parent__;)a=a.__parent__;return a}},a.ns("util.path").prototypes={pathNode:A,pathFind:B,pathExists:C},a.definePath=function(a){Object.defineProperties(a,{pathNode:{value:A},pathFind:{value:B},pathExists:{value:C}})}}(Crisp);